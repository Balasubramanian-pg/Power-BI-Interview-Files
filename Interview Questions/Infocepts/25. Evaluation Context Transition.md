### 25. How does **evaluation context transition** happen inside CALCULATE with nested iterators?

This is an advanced DAX concept that combines two fundamental mechanisms: Row Context and Context Transition.

#### The Building Blocks
*   **Row Context:** An environment that exists only during the evaluation of a calculated column or an iterator function (like `SUMX`, `FILTER`, `ADDCOLUMNS`). It understands the concept of "the current row" and can access the values of columns in that row.
*   **Context Transition:** This is the magic performed by the `CALCULATE` function. When `CALCULATE` is evaluated inside a Row Context, it transforms that Row Context into an equivalent Filter Context. It essentially creates a new filter for every column in the current row, pinning it to that row's value.

#### The Nested Scenario Explained
Let's analyze a measure with a nested iterator:
```dax
Avg Sales of Other Products in Same Category =
AVERAGEX(
    'Product',  -- Outer Iterator: Creates a row context for each product
    CALCULATE(   -- Context Transition happens here
        AVERAGEX(
            FILTER(
                'Sales',
                'Sales'[ProductKey] <> EARLIER('Product'[ProductKey]) -- Inner Iterator
            ),
            'Sales'[Quantity] * 'Sales'[Net Price]
        )
    )
)
```
1.  **Outer Iterator (`AVERAGEX` on `Product`):**
    *   The outer `AVERAGEX` begins to iterate through the `Product` table, one row at a time. Let's say it's currently on the row for "Product A," which is in the "Electronics" category. This creates a Row Context.

2.  **Context Transition (`CALCULATE`):**
    *   The `CALCULATE` function is encountered. It sees the active Row Context for "Product A."
    *   It performs context transition, creating a new Filter Context that is equivalent to `FILTER(ALL('Product'), 'Product'[ProductKey] = [Key for Product A] && 'Product'[Category] = "Electronics" && ... etc.)`.

3.  **Inner Iterator (`AVERAGEX` on the filtered `Sales` table):**
    *   Now, the inner `AVERAGEX` starts its work *within this new Filter Context*.
    *   It iterates the `Sales` table. Because of the filter context created by `CALCULATE`, it is only iterating over the sales for "Product A."
    *   The `FILTER` function inside adds another condition, excluding the sales for the current product itself (using `EARLIER`), though a more modern approach would use variables.
    *   The result is that the inner expression calculates the average sales for all products that are *not* "Product A" but are in the "Electronics" category.

4.  **Looping:** The outer `AVERAGEX` then moves to the next product, and the entire process repeats.
