## 15. What are the trade-offs between using **calculated columns** in DAX vs. in Power Query M?

This is a fundamental data modeling choice with significant implications for performance, refresh time, and flexibility.

#### Calculated Columns in Power Query (M)
*   **When it's Calculated:** During data refresh.
*   **Pros:**
    *   **Pre-computed and Stored:** The values are calculated once during refresh and materialized in the table. This means they do not consume CPU resources at query time.
    *   **Better Compression:** Because the column is materialized before compression, the VertiPaq engine can apply standard compression techniques (like dictionary encoding) to it. If the resulting column has low cardinality, this is very efficient.
    *   **Can be Query-Folded:** If the transformation is supported, the calculation can be pushed back to the data source, which is highly efficient.
*   **Cons:**
    *   **Static:** The values are only updated when the dataset is refreshed. They cannot react to user selections (slicers) on the report.
    *   **No Access to Model Relationships:** M calculations are row-by-row and can only see data within the current table (or data explicitly merged from other queries). They cannot use DAX functions like `RELATED()` to look up values across model relationships.

#### Calculated Columns in DAX
*   **When it's Calculated:** During data refresh (or `Process Recalc`), after the tables are loaded into the model.
*   **Pros:**
    *   **Access to the Full Model:** DAX calculations have full awareness of the data model, including all tables, relationships, and measures. This allows for powerful logic using functions like `RELATED`, `CALCULATE`, etc.
    *   **Complex Row-Context Logic:** It can perform sophisticated calculations for each row based on values from related tables.
*   **Cons:**
    *   **Worse Compression:** DAX calculated columns are computed *after* the initial data load and compression. This often leads to less optimal compression compared to a column imported directly or created in Power Query.
    *   **Increased Model Size and Refresh Time:** Each DAX calculated column is stored in memory just like any other column, consuming RAM. Complex DAX columns can also add significant time to the data refresh process.
    *   **Static (like M columns):** Despite being written in DAX, calculated columns are still evaluated at refresh and are not dynamic. This is a common point of confusion; they do not respond to slicers.

> **Guideline:**
> * **Use Power Query M when:** The calculation is based only on other columns in the same row, is static, and doesn't require model relationships. This is the preferred method for data preparation.
> * **Use DAX Calculated Columns when:** The calculation for each row absolutely requires looking up values from other tables across model relationships (e.g., fetching a product category for each sales line).
> * **Use Measures when:** The calculation needs to be dynamic and respond to user filters and slicers.

