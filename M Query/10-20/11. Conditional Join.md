#### **Scenario 2: Conditional Join (Non-Equi Join)**

You need to join two tables where the condition is not a simple equality (`A.key = B.key`) but involves a range, like a date falling between a start and end date.

**The Scenario:**
You have a `Sales` table and a `Promotions` table. You want to match each sale with the promotion that was active on the sale date.

**The Challenge:**
The standard `Merge Queries` UI only allows joining on columns being equal. It cannot handle "between" logic (`SaleDate >= PromoStart AND SaleDate <= PromoEnd`).

**The M Query Solution:**
We add a custom column to the `Sales` table. For each sales row, it filters the *entire* `Promotions` table to find the matching promotion and returns its name.

```m
let
    // Sales Table
    Sales = Table.FromRecords({
        [SaleID=1, SaleDate=#date(2023,1,5), Amount=50],
        [SaleID=2, SaleDate=#date(2023,1,15), Amount=120],
        [SaleID=3, SaleDate=#date(2023,2,10), Amount=200]
    }, type table [SaleID=Int64.Type, SaleDate=Date.Type, Amount=Int64.Type]),

    // Promotions Table
    Promotions = Table.FromRecords({
        [PromoName="New Year Sale", StartDate=#date(2023,1,1), EndDate=#date(2023,1,10)],
        [PromoName="Winter Special", StartDate=#date(2023,1,11), EndDate=#date(2023,1,31)],
        [PromoName="Valentines Deal", StartDate=#date(2023,2,1), EndDate=#date(2023,2,14)]
    }, type table [PromoName=Text.Type, StartDate=Date.Type, EndDate=Date.Type]),

    // Add a custom column to the Sales table
    #"Added Promotion" = Table.AddColumn(Sales, "Promotion Name", (CurrentSalesRow) =>
        // For each row in the Sales table, filter the Promotions table
        let
            MatchingPromo = Table.SelectRows(Promotions, each
                CurrentSalesRow[SaleDate] >= [StartDate] and
                CurrentSalesRow[SaleDate] <= [EndDate]
            )
        in
            // Get the PromoName from the first matching row. Use '?' for safety if no match is found.
            Table.First(MatchingPromo)?[PromoName],
        type text
    )
in
    #"Added Promotion"
```
**Explanation:**
1.  `Table.AddColumn` iterates through each row of the `Sales` table. We call the context of the current row `CurrentSalesRow`.
2.  Inside the custom column logic, `Table.SelectRows` filters the *entire* `Promotions` table based on the `SaleDate` from the `CurrentSalesRow`.
3.  This returns a (potentially empty) table of matching promotions.
4.  `Table.First(â€¦)[PromoName]` extracts the name from the first record of that filtered table. The `?` (optional item operator) prevents an error if no match is found, returning `null` instead.
